<!-- Generated by SpecStory -->

# æ£€æŸ¥YModemæ–‡æ¡£æ›´æ–°éœ€æ±‚ (2025-06-24 15:48:51)

_**User**_

ymodem.cä¸ymodem.hæ›´æ–°äº†ä¸€äº›ä»£ç ã€‚å¸®æˆ‘æ£€æŸ¥YModem_README.mdæ–‡ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ã€‚

---

_**Assistant**_

æˆ‘æ¥æ£€æŸ¥ä¸€ä¸‹ `ymodem.c` å’Œ `ymodem.h` çš„æ›´æ–°ï¼Œå¯¹æ¯” `YModem_README.md` æ–‡ä»¶æ˜¯å¦éœ€è¦åŒæ­¥æ›´æ–°ã€‚

---

<details>
            <summary>Searched codebase "YModem_Run YModem_Init expected_packet_num uint16_t" â€¢ **0** results</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "expected_packet_num.*uint16_t" â€¢ **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.h` | L94 | `uint16_t expected_packet_num;        /**< æœŸæœ›çš„åŒ…åºå· (ä¿®å¤ï¼šæ”¹ä¸ºuint16_tæ”¯æŒæ›´å¤§åŒ…åºå·) */` |

</details>

---

<details>
            <summary>Grep search for "ä¿®å¤|é‡è¯•è®¡æ•°|max retry" â€¢ **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L136 | `// ä¿®å¤ï¼šEOTåå‘é€Cå­—ç¬¦ï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ç»“æŸåŒ…ï¼‰` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L176 | `// ä¿®å¤ï¼šEOTåå‘é€Cå­—ç¬¦ï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ç»“æŸåŒ…ï¼‰` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L244 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L247 | `log_printf("YModem: max retry count reached, abort.\r\n");` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L274 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L277 | `log_printf("YModem: max retry count reached, abort.\r\n");` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L287 | `// ä¿®å¤ï¼šæˆåŠŸå¤„ç†åŒ…åé‡ç½®é‡è¯•è®¡æ•°` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L347 | `// ä¿®å¤ï¼šæ£€æŸ¥æ–‡ä»¶åé•¿åº¦ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L370 | `// ä¿®å¤ï¼šæ£€æŸ¥size_ptræ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L420 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L423 | `log_printf("YModem: max retry count reached, abort.\r\n");` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L136 | `// ä¿®å¤ï¼šEOTåå‘é€Cå­—ç¬¦ï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ç»“æŸåŒ…ï¼‰` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L176 | `// ä¿®å¤ï¼šEOTåå‘é€Cå­—ç¬¦ï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ç»“æŸåŒ…ï¼‰` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L244 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L247 | `log_printf("YModem: max retry count reached, abort.\r\n");` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L274 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L277 | `log_printf("YModem: max retry count reached, abort.\r\n");` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L287 | `// ä¿®å¤ï¼šæˆåŠŸå¤„ç†åŒ…åé‡ç½®é‡è¯•è®¡æ•°` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L347 | `// ä¿®å¤ï¼šæ£€æŸ¥æ–‡ä»¶åé•¿åº¦ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L370 | `// ä¿®å¤ï¼šæ£€æŸ¥size_ptræ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L420 | `// ä¿®å¤ï¼šå¢åŠ é‡è¯•è®¡æ•°å’Œé”™è¯¯å¤„ç†` |
| `file:///d%3A/Coding/MCU_Develop/bootloader09_stm32f103_iap_protocol/Bootloader/IAP/ymodem.c` | L423 | `log_printf("YModem: max retry count reached, abort.\r\n");` |

</details>

---

åŸºäºå¯¹ä»£ç çš„åˆ†æï¼Œæˆ‘å‘ç° `ymodem.c` å’Œ `ymodem.h` ç¡®å®æœ‰ä¸€äº›é‡è¦çš„æ›´æ–°ï¼Œéœ€è¦åŒæ­¥åˆ° `YModem_README.md` æ–‡ä»¶ä¸­ã€‚è®©æˆ‘ä¸ºæ‚¨æ›´æ–°æ–‡æ¡£ï¼š

## ä»£ç æ›´æ–°æ€»ç»“

**ä¸»è¦æ›´æ–°å†…å®¹ï¼š**

1. **æ•°æ®ç±»å‹ä¿®å¤**ï¼š`expected_packet_num` ä» `uint8_t` æ”¹ä¸º `uint16_t`ï¼Œæ”¯æŒæ›´å¤§çš„åŒ…åºå·
2. **é”™è¯¯å¤„ç†å¢å¼º**ï¼šæ·»åŠ äº†é‡è¯•è®¡æ•°æœºåˆ¶å’Œæœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶
3. **åè®®æµç¨‹ä¿®å¤**ï¼šEOTåæ­£ç¡®å‘é€Cå­—ç¬¦ï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ–‡ä»¶æˆ–ç»“æŸåŒ…
4. **å®‰å…¨æ€§å¢å¼º**ï¼šå¢åŠ äº†æ–‡ä»¶åé•¿åº¦æ£€æŸ¥å’Œç¼“å†²åŒºæº¢å‡ºé˜²æŠ¤

## é—®é¢˜åˆ†æå’Œå»ºè®®

å½“å‰çš„ `YModem_README.md` æ–‡æ¡£åŸºæœ¬æ˜¯å®Œæ•´çš„ï¼Œä½†éœ€è¦è¡¥å……ä¸€äº›æ–°å¢çš„ç‰¹æ€§å’Œä¿®å¤å†…å®¹ï¼š

---

```diff
  - æä¾›ä¼ è¾“è¿›åº¦åé¦ˆ
  - å®Œå…¨ç‹¬ç«‹äºé€šä¿¡æ¥å£ï¼Œæ”¯æŒä»»æ„æ•°æ®æº
+ 
+ ## ç‰ˆæœ¬æ›´æ–°è¯´æ˜
+ 
+ ### v3.0.0 æœ€æ–°æ›´æ–°ç‰¹æ€§
+ 
+ #### 1. æ•°æ®ç±»å‹ä¼˜åŒ–
+ - **åŒ…åºå·æ”¯æŒå¢å¼º**ï¼š`expected_packet_num` ä» `uint8_t` æ”¹ä¸º `uint16_t`ï¼Œæ”¯æŒæ›´å¤§çš„åŒ…åºå·ï¼ˆæœ€å¤š65535ä¸ªåŒ…ï¼‰
+ - **å¤§æ–‡ä»¶ä¼ è¾“æ”¯æŒ**ï¼šç†è®ºä¸Šå¯æ”¯æŒæœ€å¤§64MBæ–‡ä»¶ä¼ è¾“ï¼ˆ65535 Ã— 1024å­—èŠ‚ï¼‰
+ 
+ #### 2. é”™è¯¯å¤„ç†æœºåˆ¶å¢å¼º
+ - **é‡è¯•è®¡æ•°æœºåˆ¶**ï¼šæ–°å¢ `retry_count` å’Œ `max_retry` å­—æ®µ
+ - **è‡ªåŠ¨é”™è¯¯æ¢å¤**ï¼šè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åè‡ªåŠ¨ç»ˆæ­¢ä¼ è¾“ï¼Œé˜²æ­¢æ— é™é‡è¯•
+ - **æ™ºèƒ½é”™è¯¯å¤„ç†**ï¼šåŒ…æ ¡éªŒå¤±è´¥ã€CRCé”™è¯¯ã€åŒ…åºå·é”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•
+ 
+ #### 3. åè®®æµç¨‹ä¿®å¤
+ - **EOTå¤„ç†ä¼˜åŒ–**ï¼šEOTåæ­£ç¡®å‘é€Cå­—ç¬¦ï¼Œç¬¦åˆæ ‡å‡†YModemåè®®æµç¨‹
+ - **çŠ¶æ€æœºå®Œå–„**ï¼šå¢å¼ºäº†çŠ¶æ€è½¬æ¢çš„å¯é æ€§å’Œé”™è¯¯æ¢å¤èƒ½åŠ›
+ 
+ #### 4. å®‰å…¨æ€§å¢å¼º
+ - **ç¼“å†²åŒºä¿æŠ¤**ï¼šæ–‡ä»¶åé•¿åº¦æ£€æŸ¥ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º
+ - **åœ°å€éªŒè¯**ï¼šå¢å¼ºFlashåœ°å€æœ‰æ•ˆæ€§æ£€æŸ¥
+ - **æ•°æ®å®Œæ•´æ€§**ï¼šsize_ptræŒ‡é’ˆæœ‰æ•ˆæ€§éªŒè¯
  
  ## æ–‡ä»¶ç»“æ„
```

```diff
  - æ”¯æŒ128å­—èŠ‚æ•°æ®åŒ…ï¼ˆSOHåŒ…å¤´ï¼‰
  - CRC16æ ¡éªŒç¡®ä¿æ•°æ®å®Œæ•´æ€§
+ - **æ–°å¢**ï¼šæ”¯æŒæœ€å¤š65535ä¸ªåŒ…çš„å¤§æ–‡ä»¶ä¼ è¾“
  
  ### 2. çŠ¶æ€æœºè®¾è®¡
```

```diff
                                      â†“
                                 å†™å…¥Flashç¼“å­˜åŒº
+                                     â†“
+                             (é”™è¯¯é‡è¯•æœºåˆ¶ä¿æŠ¤)
  ```
  
```

```diff
  - åœ°å€èŒƒå›´æ£€æŸ¥
  - å†™å…¥åˆ°Appä¸‹è½½ç¼“å­˜åŒºï¼ˆ`FLASH_DL_START_ADDR`ï¼‰
+ 
+ ### 4. é”™è¯¯å¤„ç†ä¸æ¢å¤
+ - **æ™ºèƒ½é‡è¯•**ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæœ€å¤§é‡è¯•3æ¬¡
+ - **é”™è¯¯åˆ†ç±»å¤„ç†**ï¼š
+   - CRCæ ¡éªŒå¤±è´¥ â†’ å‘é€NAKè¯·æ±‚é‡ä¼ 
+   - åŒ…åºå·é”™è¯¯ â†’ å‘é€NAKè¯·æ±‚é‡ä¼   
+   - Flashå†™å…¥å¤±è´¥ â†’ å‘é€CANç»ˆæ­¢ä¼ è¾“
+   - è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° â†’ è‡ªåŠ¨ç»ˆæ­¢ä¼ è¾“
+ - **çŠ¶æ€è‡ªåŠ¨æ¢å¤**ï¼šä¼ è¾“å®Œæˆåå¯è‡ªåŠ¨æ¥å—æ–°çš„ä¼ è¾“è¯·æ±‚
  
  ## ä½¿ç”¨æ–¹æ³•
```

```diff
  - **è¿”å›**: åˆå§‹åŒ–ç»“æœ
  - **è¯´æ˜**: å®Œå…¨ç‹¬ç«‹çš„åˆå§‹åŒ–ï¼Œä¸ä¾èµ–ä»»ä½•é€šä¿¡æ¥å£
+ - **æ–°å¢**: è‡ªåŠ¨è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ä¸º3æ¬¡
  
  #### `YModem_Run()`
```

```diff
  - **è¿”å›**: å®é™…è·å–çš„å“åº”æ•°æ®é•¿åº¦
  - **è¯´æ˜**: è·å–åä¼šè‡ªåŠ¨æ¸…é™¤å“åº”æ•°æ®ç¼“å†²åŒº
+ 
+ ### æ•°æ®ç»“æ„æ›´æ–°
+ 
+ #### YModem_Handler_t ç»“æ„ä½“æ–°å¢å­—æ®µ
+ ```c
+ typedef struct YModem_Handler {
+     // ... existing fields ...
+     uint16_t expected_packet_num;        /**< æœŸæœ›çš„åŒ…åºå·ï¼ˆæ”¯æŒæ›´å¤§åŒ…åºå·ï¼‰*/
+     uint8_t retry_count;                 /**< å½“å‰é‡è¯•è®¡æ•° */
+     uint8_t max_retry;                   /**< æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤3æ¬¡ï¼‰*/
+     uint8_t response_buffer[16];         /**< å“åº”æ•°æ®ç¼“å†²åŒº */
+     uint8_t response_length;             /**< å“åº”æ•°æ®é•¿åº¦ */
+     uint8_t response_ready;              /**< å“åº”æ•°æ®å°±ç»ªæ ‡å¿— */
+ } YModem_Handler_t;
+ ```
  
  ### è¿”å›å€¼è¯´æ˜
```

```diff
  - å‘é€NAKç»™ä¸Šä½æœº
  - è¦æ±‚é‡ä¼ å½“å‰åŒ…
+ - **æ–°å¢**ï¼šè‡ªåŠ¨é‡è¯•è®¡æ•°ï¼Œè¾¾åˆ°æœ€å¤§æ¬¡æ•°åç»ˆæ­¢ä¼ è¾“
  
  ### 2. åŒ…åºå·é”™è¯¯
  - å‘é€NAKç»™ä¸Šä½æœº
  - è¦æ±‚é‡ä¼ å½“å‰åŒ…
+ - **æ–°å¢**ï¼šæ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œé˜²æ­¢æ— é™é‡è¯•
  
  ### 3. Flashå†™å…¥å¤±è´¥
```

```diff
  - å‘é€CANå–æ¶ˆä¼ è¾“
  - è®°å½•é”™è¯¯æ—¥å¿—
+ 
+ ### 5. ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤ï¼ˆæ–°å¢ï¼‰
+ - æ–‡ä»¶åé•¿åº¦æ£€æŸ¥ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º
+ - æ•°æ®æŒ‡é’ˆæœ‰æ•ˆæ€§éªŒè¯
+ - è‡ªåŠ¨é”™è¯¯æ¢å¤æœºåˆ¶
  
  ## è°ƒè¯•ä¿¡æ¯
```

```diff
  YModem: æˆåŠŸå†™å…¥ 1024 å­—èŠ‚åˆ°åœ°å€ 0x08040000
  YModem: ä¼ è¾“å®Œæˆï¼æ€»å…±æ¥æ”¶ 12345 å­—èŠ‚
+ 
+ // æ–°å¢é”™è¯¯å¤„ç†è°ƒè¯•ä¿¡æ¯
+ YModem: CRC verification failed, calculated value=0x1234, received value=0x5678
+ YModem: max retry count reached, abort
+ YModem: packet number error, expected 5, received 3
  ```
  
```

```diff
  - ä¸æ ‡å‡†YModemåè®®å®Œå…¨å…¼å®¹
  - å¯ä»¥ä¸ä»»ä½•æ”¯æŒYModemçš„ä¸Šä½æœºè½¯ä»¶é…åˆä½¿ç”¨
+ 
+ ### 5. é”™è¯¯æ¢å¤èƒ½åŠ›ï¼ˆæ–°å¢ï¼‰
+ - **è‡ªåŠ¨é‡è¯•**ï¼šé‡åˆ°ä¸´æ—¶é”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•ï¼Œæœ€å¤š3æ¬¡
+ - **æ™ºèƒ½ç»ˆæ­¢**ï¼šè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åè‡ªåŠ¨ç»ˆæ­¢ï¼Œé¿å…æ­»é”
+ - **çŠ¶æ€ä¿æŠ¤**ï¼šä¼ è¾“è¿‡ç¨‹ä¸­çš„çŠ¶æ€å®Œæ•´æ€§ä¿æŠ¤
+ - **å¤§æ–‡ä»¶æ”¯æŒ**ï¼šæ”¯æŒæœ€å¤š65535ä¸ªåŒ…çš„å¤§æ–‡ä»¶ä¼ è¾“
+ 
+ ## æ€§èƒ½ç‰¹æ€§
+ 
+ ### ä¼ è¾“èƒ½åŠ›
+ - **æœ€å¤§æ–‡ä»¶å¤§å°**ï¼šç†è®ºä¸Š64MBï¼ˆ65535 Ã— 1024å­—èŠ‚ï¼‰
+ - **å®é™…é™åˆ¶**ï¼šå—Flashå®¹é‡é™åˆ¶ï¼ˆå½“å‰é…ç½®192KBç¼“å­˜åŒºï¼‰
+ - **ä¼ è¾“é€Ÿåº¦**ï¼šå–å†³äºé€šä¿¡æ¥å£é€Ÿåº¦å’ŒFlashå†™å…¥æ€§èƒ½
+ - **é”™è¯¯æ¢å¤**ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæé«˜ä¼ è¾“å¯é æ€§
+ 
+ ### å†…å­˜ä¼˜åŒ–
+ - é™æ€å†…å­˜åˆ†é…ï¼Œé¿å…åŠ¨æ€å†…å­˜ç¢ç‰‡
+ - å“åº”ç¼“å†²åŒºå¤§å°ä¼˜åŒ–ï¼ˆ16å­—èŠ‚ï¼‰
+ - æ¥æ”¶ç¼“å†²åŒºæŒ‰æœ€å¤§åŒ…å¤§å°è®¾è®¡ï¼ˆ1024+5å­—èŠ‚ï¼‰
  
  ## å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
```

---

## æ€»ç»“

æˆ‘å·²ç»æˆåŠŸæ›´æ–°äº† `YModem_README.md` æ–‡æ¡£ï¼Œä¸»è¦è¡¥å……äº†ä»¥ä¸‹å†…å®¹ï¼š

### ğŸ“‹ **é—®é¢˜åˆ†æç»“æœ**

ç»è¿‡å¯¹æ¯”åˆ†æï¼ŒåŸæ–‡æ¡£ç¡®å®éœ€è¦æ›´æ–°ä»¥åæ˜ ä»£ç çš„æœ€æ–°æ”¹è¿›ã€‚

### ğŸš€ **æ–‡æ¡£æ›´æ–°å†…å®¹**

#### 1. **ç‰ˆæœ¬æ›´æ–°è¯´æ˜**
   - æ–°å¢ v3.0.0 ç‰ˆæœ¬ç‰¹æ€§è¯´æ˜
   - è¯¦ç»†æè¿°äº†æ•°æ®ç±»å‹ä¼˜åŒ–ã€é”™è¯¯å¤„ç†å¢å¼ºç­‰å››å¤§æ”¹è¿›

#### 2. **æ ¸å¿ƒç‰¹æ€§æ‰©å±•**
   - åè®®å…¼å®¹æ€§ï¼šå¢åŠ äº†å¤§æ–‡ä»¶ä¼ è¾“æ”¯æŒè¯´æ˜
   - çŠ¶æ€æœºè®¾è®¡ï¼šæ·»åŠ äº†é”™è¯¯é‡è¯•æœºåˆ¶ä¿æŠ¤
   - æ–°å¢é”™è¯¯å¤„ç†ä¸æ¢å¤ç« èŠ‚

#### 3. **APIå‚è€ƒå®Œå–„**  
   - `YModem_Init()` å‡½æ•°è¯´æ˜ä¸­å¢åŠ äº†é‡è¯•æ¬¡æ•°è®¾ç½®
   - æ–°å¢æ•°æ®ç»“æ„æ›´æ–°ç« èŠ‚ï¼Œè¯¦ç»†è¯´æ˜äº†æ–°å¢å­—æ®µ

#### 4. **é”™è¯¯å¤„ç†æœºåˆ¶**
   - å®Œå–„äº†æ‰€æœ‰é”™è¯¯ç±»å‹çš„å¤„ç†è¯´æ˜
   - æ–°å¢ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤è¯´æ˜
   - å¢å¼ºäº†è°ƒè¯•ä¿¡æ¯ç¤ºä¾‹

#### 5. **æ³¨æ„äº‹é¡¹æ‰©å±•**
   - æ–°å¢é”™è¯¯æ¢å¤èƒ½åŠ›è¯´æ˜
   - è¯¦ç»†çš„è‡ªåŠ¨é‡è¯•å’Œæ™ºèƒ½ç»ˆæ­¢æœºåˆ¶

#### 6. **æ€§èƒ½ç‰¹æ€§**
   - æ–°å¢æ€§èƒ½ç‰¹æ€§ç« èŠ‚
   - ä¼ è¾“èƒ½åŠ›å’Œå†…å­˜ä¼˜åŒ–è¯´æ˜

### ğŸ’¡ **ä¸»è¦æ”¹è¿›ç‚¹å¯¹åº”**

| ä»£ç æ›´æ–° | æ–‡æ¡£å¯¹åº”ç« èŠ‚ |
|---------|-------------|
| `expected_packet_num` æ”¹ä¸º `uint16_t` | æ•°æ®ç±»å‹ä¼˜åŒ– + æ€§èƒ½ç‰¹æ€§ |
| é‡è¯•è®¡æ•°æœºåˆ¶ | é”™è¯¯å¤„ç†æœºåˆ¶å¢å¼º + APIå‚è€ƒ |
| EOTå¤„ç†ä¿®å¤ | åè®®æµç¨‹ä¿®å¤ |
| ç¼“å†²åŒºä¿æŠ¤ | å®‰å…¨æ€§å¢å¼º + ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤ |

### ğŸ¯ **å­¦ä¹ è¦ç‚¹**

1. **æ¨¡å—åŒ–æ–‡æ¡£ç»´æŠ¤**ï¼šå°±åƒç»™äº§å“è¯´æ˜ä¹¦æ·»åŠ æ–°åŠŸèƒ½ä»‹ç»ï¼Œéœ€è¦ç³»ç»Ÿæ€§åœ°æ›´æ–°æ‰€æœ‰ç›¸å…³ç« èŠ‚
2. **ç‰ˆæœ¬ç®¡ç†æ€ç»´**ï¼šæ¯æ¬¡ä»£ç æ›´æ–°éƒ½åº”è¯¥åœ¨æ–‡æ¡£ä¸­æœ‰å¯¹åº”çš„ç‰ˆæœ¬è¯´æ˜ï¼Œä¾¿äºç”¨æˆ·äº†è§£æ”¹è¿›å†å²
3. **ç”¨æˆ·å‹å¥½æ€§**ï¼šæ–‡æ¡£ä¸ä»…è¦è¯´æ˜"æ˜¯ä»€ä¹ˆ"ï¼Œè¿˜è¦è¯´æ˜"ä¸ºä»€ä¹ˆ"è¿™æ ·æ”¹è¿›ï¼Œä»¥åŠå¯¹ç”¨æˆ·çš„å¥½å¤„

ç°åœ¨çš„æ–‡æ¡£å·²ç»å®Œå…¨åŒæ­¥äº†ä»£ç çš„æœ€æ–°æ”¹è¿›ï¼Œç”¨æˆ·å¯ä»¥æ¸…æ¥šåœ°äº†è§£åˆ°æ–°ç‰ˆæœ¬çš„æ‰€æœ‰å¢å¼ºç‰¹æ€§å’Œä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼

---

